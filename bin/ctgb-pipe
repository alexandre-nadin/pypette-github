#!/usr/bin/env bash
set -euf -o pipefail
source ctgb-pipe.sh

# -------------------
# Parse parameters
# -------------------
function parseParams() {
  while [ $# -ge 1 ]
  do
      case "$1" in
        --project)
          PROJECT="$2" && shift
          ;;

        -p|--pipeline)
          PIPELINE="$2" && shift
          ;;
  
        --snakemake)
          SNAKE_OPTIONS+=("$2") && shift
          ;;

        -c|--conda-env)
          CONDA_ENV="$2" && shift
          ;;
  
        -h|--help)
          manual && exit
          ;;
  
        --ls-pipes)
          pipe::listPipelines
          exit
          ;;
  
        --ls-modules)
          pipe::listModules
          exit
          ;;

        -d|--directory)
          SNAKE_DIR="$2" && shift
          ;;
             
        -v|--verbose)
          VERBOSE=true
          ;;
  
        *)
          pipe::errorUnrecOpt "$1"
          ;;
  
      esac
      shift
  done
}

function runFlow() {
  initParams
  parseParams "$@"
  checkParams
  envActivate
  exportVarenvs
  execSnakemake
}

runFlow "$@"
